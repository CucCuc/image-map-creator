!function(e,t){for(var s in t)e[s]=t[s]}(window,function(e){var t={};function s(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(r,o,function(t){return e[t]}.bind(null,o));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";function r(e,t,s,r=!0){if(t>s){let e=t;t=s,s=e}return r?e>=t&&e<=s:e>t&&e<s}s.r(t);class o{constructor(e,t){this.set(e,t)}set(e,t){this.x=e,this.y=t}static fromObject(e){return new o(e.x,e.y)}static dist(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static swap(e,t,s){let r=e[s];e[s]=t[s],t[s]=r}isEmpty(){return!this.x&&!this.y}oneIsEmpty(){return!this.x||!this.y}sum(e){return new o(this.x+e.x,this.y+e.y)}diff(e){return new o(this.x-e.x,this.y-e.y)}invert(){return new o(-this.x,-this.y)}toString(e,t){return function(e,t){return parseFloat(e.toFixed(t))}(this[t],e)}toHtml(e){return this.toString(e,"x")+","+this.toString(e,"y")}}class a{constructor(e,t=[],s,r=0){this.setShape(e),this.setCoords(t),this.setHref(s),this.setId(r)}static fromObject(e){switch(e.shape){case"rect":return new n(e.coords.map(o.fromObject),e.href,e.id);case"circle":return new i(e.coords.map(o.fromObject),e.radius,e.href,e.id);case"poly":return new d(e.coords.map(o.fromObject),e.href,e.id);case"default":return new u(e.href);default:throw"Not an area"}}setShape(e){this.shape=e}addCoord(e,t){return this.coords.push(new o(e,t))}setCoords(e){this.coords=e}getCoords(e="default"){switch(e){case"default":default:return this.coords}}empty(){return 0==this.coords.length}copyCoords(){let e=[];return this.coords.forEach((t,s)=>{e[s]=new o(t.x,t.y)}),e}updateLastCoord(e,t){this.coords[this.coords.length-1]=new o(e,t)}move(e){let t=this.firstCoord();void 0!=t&&(this.coords[0]=t.sum(e))}isDrawable(){return this.coords.length>=1}isValidShape(){return this.isDrawable()}setHref(e){this.href=e}setId(e){this.id=e}firstCoord(){return this.coords[0]}distToFirstCoord(e,t){let s=new o(e,t);return o.dist(s,this.firstCoord())}htmlCoords(e){return this.getCoords("html").map(t=>t.toHtml(e)).join(",")}toHtml(){let e=this.htmlCoords(0);return""!=e&&(e='coords="'+e+'" '),'<area shape="'+this.shape+'" '+e+'href="'+this.href+'" alt="'+this.href+'"/>'}svgArea(){}toSvg(){return'<a xlink:href="'+this.href+'">'+this.svgArea()+"</a>"}}class n extends a{constructor(e=[],t,s){super("rect",e,t,s)}setCoords(e){super.setCoords(e.slice(0,2))}updateLastCoord(e,t){if(2==this.coords.length){let s=this.firstCoord();this.coords[1]=new o(e-s.x,t-s.y)}}isDrawable(){return 2==this.coords.length&&!this.coords[1].oneIsEmpty()}isHover(e,t){let s=this.firstCoord(),o=this.coords[1].sum(s);return r(e,s.x,o.x)&&r(t,s.y,o.y)}display(e){e.rect(this.coords[0].x,this.coords[0].y,this.coords[1].x,this.coords[1].y)}getCoords(e="default"){switch(e){case"html":let t=this.copyCoords();return t[1]=t[1].sum(t[0]),t[0].x>t[1].x&&o.swap(t[0],t[1],"x"),t[0].y>t[1].y&&o.swap(t[0],t[1],"y"),t;default:return super.getCoords(e)}}svgArea(){return'<rect x="'+this.coords[0].toString(0,"x")+'" y="'+this.coords[0].toString(0,"y")+'" width="'+this.coords[1].toString(0,"x")+'" height="'+this.coords[1].toString(0,"y")+'" />'}}class i extends a{constructor(e=[],t=0,s,r){super("circle",e,s,r),this.radius=t}getCenter(){return this.firstCoord}isValidShape(){return super.isValidShape()&&this.radius>0}isHover(e,t){let s=this.getCenter();return o.dist(new o(e,t),s)<this.radius}updateLastCoord(e,t){let s=this.getCenter();this.radius=o.dist(s,new o(e,t))}display(e){e.ellipse(this.getCenter().x,this.getCenter().y,2*this.radius)}htmlCoords(e){return this.getCenter().toHtml(e)+","+round(this.radius,e)}svgArea(){return'<circle cx="'+this.coords[0].toString(0,"x")+'" cy="'+this.coords[0].toString(0,"y")+'" r="'+round(this.radius,0)+'" />'}}class d extends a{constructor(e=[],t,s){super("poly",e,t,s)}isValidShape(){return this.coords.length>=4}isHover(e,t){let s,r=this.coords.map(e=>e.x),o=this.coords.map(e=>e.y),a=r.length-1,n=!1,i=r,d=o;for(s=0;s<r.length;s++)(d[s]<t&&d[a]>=t||d[a]<t&&d[s]>=t)&&(i[s]<=e||i[a]<=e)&&(n^=i[s]+(t-d[s])/(d[a]-d[s])*(i[a]-i[s])<e),a=s;return n}isClosable(e,t,s=5){return this.isValidShape()&&this.distToFirstCoord(e,t)<s}close(){this.coords[this.coords.length-1]=this.firstCoord()}move(e){this.coords=this.coords.map(t=>t.sum(e))}display(e){e.beginShape(),this.coords.forEach(t=>e.vertex(t.x,t.y)),e.endShape()}svgArea(){return'<polygon points="'+this.coords.map(e=>e.toString(0,"x")+","+e.toString(0,"y")).join(" ")+'" />'}}class u extends a{constructor(e){super("default",[],e),this.isDefault=!0}isDrawable(){return!0}isHover(){return!0}display(e){e.rect(0,0,e.getMap().width-1,e.getMap().height-1)}svgArea(){return'<rect x="0" y="0" width="100%" height="100%" />'}}s.d(t,"imageMapCreator",function(){return c});let c=function(e,t=600,s=450){let r,c,l="rectangle",h=["rectangle","circle","polygon"],f={SetUrl:{onSelect:(e,t,s,r)=>{!function(e){let t=e.href,s=prompt("Entrez l'url vers laquelle devrait pointer cette zone",t||"http://");null!=s&&(e.setHref(s),x.add({undo:function(){e.setHref(t)},redo:function(){e.setHref(s)}}))}(r)},label:"Set url"},Delete:(e,t,s,r)=>{B(r)},MoveFront:{onSelect:(e,t,s,r)=>{F(r,1)},enabled:!0,label:"Move Forward"},MoveBack:{onSelect:(e,t,s,r)=>{F(r,-1)},enabled:!0,label:"Move Backward"}},p=new a,m=new o,g=!1,w=!1,y=new T,v=new class{constructor(e,t,s=[],r,o=!1){this.name=r,this.width=e,this.height=t,this.areas=s,this.dArea=new u,this.hasDefaultArea=o,this.lastId=0}setFromJson(e){e=JSON.parse(e);for(const t in e)if(e.hasOwnProperty(t)){let s=e[t];"areas"==t?this.areas=s.map(a.fromObject):"dArea"==t?this.dArea=a.fromObject(s):Object.keys(this).includes(t)&&(this[t]=s)}}setName(e){this.name=e.replace(/\s+/g,"")}setSize(e,t){this.width=e,this.height=t}setDefaultArea(e){this.hasDefaultArea=e}getAreas(e=!0){let t=this.areas.slice();return e&&this.hasDefaultArea&&t.unshift(this.dArea),t}addArea(e,t=!0){return t&&e.setId(this.getNewId()),this.areas.push(e),e.id}rmletea(e){let t=this.areaIndex(e);return this.areas.splice(t,1),t}moveArea(e,t){let s=this.areaIndex(e),r=this.areas[s],o=s+t;return!(o<0||o>=this.areas.length)&&(this.rmletea(e),this.insertArea(r,o),o)}popArea(){return this.areas.pop()}insertArea(e,t){this.areas.splice(t,0,e)}areaIndex(e){return this.areas.findIndex(t=>t.id==e)}isFirstArea(e){return 0==this.areaIndex(e)}isLastArea(e){return this.areaIndex(e)==this.areas.length-1}getNewId(){return this.lastId++,this.lastId}toHtml(){let e=[];return this.getAreas().forEach(t=>{t.isValidShape()&&e.push("\t"+t.toHtml())}),'<map name="'+this.name+'" id="'+this.name+'">\n'+e.reverse().join("\n")+"\n</map>"}toSvg(){let e=[];this.getAreas(!1).forEach(t=>{t.isValidShape()&&e.push("\t"+t.toSvg())});let t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+this.width+'" height="'+this.height+'">\n';return t+=e.reverse().join("\n"),t+="\n</svg>"}toJson(){return JSON.stringify(this)}clearAreas(){this.areas=[]}setAreas(e){this.areas=e}}(t,s),x=new UndoManager,A={scale:1,transX:0,transY:0},b={min:.03,max:3,sensativity:.001};function S(){return D(e.mouseX)}function C(){return O(e.mouseY)}function D(e){return(e-A.transX)/A.scale}function O(e){return(e-A.transY)/A.scale}function k(){return e.mouseX<=e.width&&e.mouseX>=0&&e.mouseY<=e.height&&e.mouseY>=0}function M(e){y.appear(),e.preventDefault()}function j(){y.disappear()}function H(t){"image"==t.type?(c=e.loadImage(t.data,t=>(function(t){A.scale=1,A.transX=0,A.transY=0;let s=e.width/t.width,r=e.height/t.height;s<A.scale&&(A.scale=s);r<A.scale&&(A.scale=r);v.setSize(t.width,t.height)})(t)),v.name||(v.setName(t.name),r.setValue("Map Name",v.name))):"json"==t.subtype&&fetch(t.data).then(e=>e.blob()).then(e=>{console.log(e);let t=new FileReader;t.onload=function(){let e=t.result;console.log(e),v.setFromJson(e)},t.readAsText(e)}),y.disappear()}function I(e,t){let s=[new o(e,t)];switch(l){case"rectangle":(p=new n(s)).addCoord(0,0);break;case"circle":p=new i(s);break;case"polygon":(p=new d(s)).addCoord(e,t)}}function E(){download(v.toJson(),`${v.name}.map.json`,"application/json")}function V(e){v.addArea(e),x.add({undo:function(){e=v.popArea()},redo:function(){v.addArea(e,!1)}})}function B(e){let t=e.id;if(0===t)r.setValue("Default Area",!1);else{let s=v.rmletea(t);x.add({undo:function(){v.insertArea(e,s)},redo:function(){v.rmletea(t)}})}}function F(e,t){!1!==v.moveArea(e.id,t)&&x.add({undo:function(){v.moveArea(e.id,-t)},redo:function(){v.moveArea(e.id,t)}})}function N(){let e=v.getAreas(!1);v.clearAreas(),x.add({undo:function(){v.setAreas(e)},redo:function(){v.clearAreas()}})}function T(e=15){this.speed=e,this.alpha=0,this.over=!1}e.setup=function(){e.createCanvas(t,s).drop(H).dragLeave(j).dragOver(M),r=QuickSettings.create(e.width+5,0,"Image-map Creator",e.canvas.parentElement).setDraggable(!1).addText("Map Name","",e=>{v.setName(e)}).addDropDown("Tool",["rectangle","circle","polygon","inspect","move","delete","test"],e=>{!function(e){l=e,p=new a}(e.value)}).addBoolean("Default Area",v.hasDefaultArea,e=>{!function(e){v.setDefaultArea(e),x.add({undo:function(){v.setDefaultArea(!e),r.setValue("Default Area",!e)},redo:function(){v.setDefaultArea(e),r.setValue("Default Area",e)}})}(e)}).addButton("Undo",x.undo).addButton("Redo",x.redo).addButton("Clear",N).addButton("Generate Html",function(){r.setValue("Output",v.toHtml())}).addButton("Generate Svg",function(){r.setValue("Output",v.toSvg())}).addTextArea("Output").addButton("Save",E),e.canvas.addEventListener("contextmenu",function(e){e.preventDefault()})},e.draw=function(){p.empty()||p.updateLastCoord(S(),C()),w=function(){let e=v.getAreas().reverse().find(e=>e.isHover(S(),C()));return void 0!=e&&e}(),function(){if(h.includes(l))switch(l){case"polygon":if(!p.empty()&&p.isClosable(S(),C(),5/A.scale)){e.cursor(e.HAND);break}default:e.cursor(e.CROSS)}else if(e.cursor(e.ARROW),w)switch(l){case"inspect":case"test":case"delete":e.cursor(e.HAND);break;case"move":e.cursor(e.MOVE)}}(),function(){switch(l){case"inspect":if(k()){let e=w?w.href:"none";r.setValue("Output",e)}}}(),function(){if(e.background(200),!c){e.noStroke(),e.fill(0),e.textSize(15);let t="Drag and drop an image and/or a .map.json save file here";e.text(t,e.width/6,e.height/2)}}(),e.translate(A.transX,A.transY),e.scale(A.scale),c&&e.image(c,0,0,c.width,c.height),y.display(),v.getAreas().concat([p]).forEach(t=>{!function(t){let s=e.color(255,255,255,178);"inspect"!=l&&"test"!=l||(s=e.color(255,0)),(k()&&t==w&&0==g&&("inspect"==l||"delete"==l||"move"==l)||g==t)&&(s=e.color(255,200,200,178)),e.fill(s),e.strokeWeight(1/A.scale),"inspect"==l||"test"==l?e.noStroke():e.stroke(0)}(t),t.isDrawable()&&t.display(e)})},e.getMap=function(){return v},e.mousePressed=function(){if(k()&&e.mouseButton==e.LEFT&&!ContextMenu.isOpen())switch(l){case"circle":case"rectangle":I(S(),C());break;case"polygon":p.empty()?I(S(),C()):p.isClosable(S(),C(),5/A.scale)?(p.close(),p.isValidShape()&&V(p),p=new a):p.addCoord(S(),C());break;case"move":w&&(g="default"!=w.shape&&w,m=g.firstCoord())}},e.mouseDragged=function(){if(k()&&!ContextMenu.isOpen())if(e.mouseButton==e.LEFT)switch(l){case"move":if(g){let t=new o(S()-D(e.pmouseX),C()-O(e.pmouseY));g.move(t)}}else e.mouseButton==e.CENTER&&(A.transX+=e.mouseX-e.pmouseX,A.transY+=e.mouseY-e.pmouseY)},e.mouseReleased=function(t){switch(l){case"rectangle":case"circle":p.isValidShape()&&V(p),p=new a;break;case"move":if(g){let e=g,t=e.firstCoord().diff(m);x.add({undo:function(){e.move(t.invert())},redo:function(){e.move(t)}})}}!function(t){if(k()&&w){if(e.mouseButton==e.RIGHT)return g=w,f.MoveFront.enabled=!(v.isLastArea(w.id)||"default"==w.shape),f.MoveBack.enabled=!(v.isFirstArea(w.id)||"default"==w.shape),ContextMenu.display(t,f,{position:"click",data:w}),!1;if(e.mouseButton==e.LEFT)switch(l){case"test":!function(e,t=400,s=300){window.open(e,"_blank",`width=${t},height=${s}`)}(w.href);break;case"delete":B(w)}}g=!1}(t),y.disappear()},e.mouseWheel=function(e){if(k()){!function(e){let t=A.scale+e;if(t>b.min&&t<b.max){let s=S(),r=C(),o=s*e,a=r*e;A.scale=t,A.transX-=o,A.transY-=a}}(A.scale*b.sensativity*-e.delta)}},T.prototype.appear=function(){this.over=!0},T.prototype.disappear=function(){this.over=!1},T.prototype.display=function(){this.over?this.alpha<100&&(this.alpha+=this.speed):this.alpha>0&&(this.alpha-=this.speed),e.noStroke(),e.fill(255,255,255,this.alpha),e.rect(D(0),O(0),e.width/A.scale,e.height/A.scale)}}}]));