!function(e,t){for(var r in t)e[r]=t[r]}(window,function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){var s,o,n;o=[],void 0===(n="function"==typeof(s=function(){return function e(t,r,s){var o,n,a=window,i="application/octet-stream",d=s||i,u=t,c=!r&&!s&&u,l=document.createElement("a"),h=function(e){return String(e)},f=a.Blob||a.MozBlob||a.WebKitBlob||h,p=r||"download";if(f=f.call?f.bind(a):Blob,"true"===String(this)&&(d=(u=[u,d])[0],u=u[1]),c&&c.length<2048&&(p=c.split("/").pop().split("?")[0],l.href=c,-1!==l.href.indexOf(c))){var m=new XMLHttpRequest;return m.open("GET",c,!0),m.responseType="blob",m.onload=function(t){e(t.target.response,p,i)},setTimeout(function(){m.send()},0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(u)){if(!(u.length>2096103.424&&f!==h))return navigator.msSaveBlob?navigator.msSaveBlob(y(u),p):b(u);u=y(u),d=u.type||i}else if(/([\x80-\xff])/.test(u)){for(var g=0,w=new Uint8Array(u.length),v=w.length;g<v;++g)w[g]=u.charCodeAt(g);u=new f([w],{type:d})}function y(e){for(var t=e.split(/[:;,]/),r=t[1],s="base64"==t[2]?atob:decodeURIComponent,o=s(t.pop()),n=o.length,a=0,i=new Uint8Array(n);a<n;++a)i[a]=o.charCodeAt(a);return new f([i],{type:r})}function b(e,t){if("download"in l)return l.href=e,l.setAttribute("download",p),l.className="download-js-link",l.innerHTML="downloading...",l.style.display="none",document.body.appendChild(l),setTimeout(function(){l.click(),document.body.removeChild(l),!0===t&&setTimeout(function(){a.URL.revokeObjectURL(l.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var r=document.createElement("iframe");document.body.appendChild(r),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),r.src=e,setTimeout(function(){document.body.removeChild(r)},333)}if(o=u instanceof f?u:new f([u],{type:d}),navigator.msSaveBlob)return navigator.msSaveBlob(o,p);if(a.URL)b(a.URL.createObjectURL(o),!0);else{if("string"==typeof o||o.constructor===h)try{return b("data:"+d+";base64,"+a.btoa(o))}catch(e){return b("data:"+d+","+encodeURIComponent(o))}(n=new FileReader).onload=function(e){b(this.result)},n.readAsDataURL(o)}return!0}})?s.apply(t,o):s)||(e.exports=n)},function(e,t,r){"use strict";function s(e,t,r,s=!0){if(t>r){let e=t;t=r,r=e}return s?e>=t&&e<=r:e>t&&e<r}r.r(t);class o{constructor(e,t){this.set(e,t)}set(e,t){this.x=e,this.y=t}static fromObject(e){return new o(e.x,e.y)}static dist(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static swap(e,t,r){let s=e[r];e[r]=t[r],t[r]=s}isEmpty(){return!this.x&&!this.y}oneIsEmpty(){return!this.x||!this.y}sum(e){return new o(this.x+e.x,this.y+e.y)}diff(e){return new o(this.x-e.x,this.y-e.y)}invert(){return new o(-this.x,-this.y)}toString(e,t){return function(e,t){return parseFloat(e.toFixed(t))}(this[t],e)}toHtml(e){return this.toString(e,"x")+","+this.toString(e,"y")}}class n{constructor(e,t=[],r,s=0){this.setShape(e),this.setCoords(t),this.setHref(r),this.setId(s)}static fromObject(e){switch(e.shape){case"rect":return new a(e.coords.map(o.fromObject),e.href,e.id);case"circle":return new i(e.coords.map(o.fromObject),e.radius,e.href,e.id);case"poly":return new d(e.coords.map(o.fromObject),e.href,e.id);case"default":return new u(e.href);default:throw"Not an area"}}setShape(e){this.shape=e}addCoord(e,t){return this.coords.push(new o(e,t))}setCoords(e){this.coords=e}getCoords(e="default"){switch(e){case"default":default:return this.coords}}empty(){return 0==this.coords.length}copyCoords(){let e=[];return this.coords.forEach((t,r)=>{e[r]=new o(t.x,t.y)}),e}updateLastCoord(e,t){this.coords[this.coords.length-1]=new o(e,t)}move(e){let t=this.firstCoord();void 0!=t&&(this.coords[0]=t.sum(e))}isDrawable(){return this.coords.length>=1}isValidShape(){return this.isDrawable()}setHref(e){this.href=e}setId(e){this.id=e}firstCoord(){return this.coords[0]}distToFirstCoord(e,t){let r=new o(e,t);return o.dist(r,this.firstCoord())}htmlCoords(e){return this.getCoords("html").map(t=>t.toHtml(e)).join(",")}toHtml(){let e=this.htmlCoords(0);return""!=e&&(e='coords="'+e+'" '),'<area shape="'+this.shape+'" '+e+'href="'+this.href+'" alt="'+this.href+'"/>'}svgArea(){}toSvg(){return'<a xlink:href="'+this.href+'">'+this.svgArea()+"</a>"}}class a extends n{constructor(e=[],t,r){super("rect",e,t,r)}setCoords(e){super.setCoords(e.slice(0,2))}updateLastCoord(e,t){if(2==this.coords.length){let r=this.firstCoord();this.coords[1]=new o(e-r.x,t-r.y)}}isDrawable(){return 2==this.coords.length&&!this.coords[1].oneIsEmpty()}isHover(e,t){let r=this.firstCoord(),o=this.coords[1].sum(r);return s(e,r.x,o.x)&&s(t,r.y,o.y)}display(e){e.rect(this.coords[0].x,this.coords[0].y,this.coords[1].x,this.coords[1].y)}getCoords(e="default"){switch(e){case"html":let t=this.copyCoords();return t[1]=t[1].sum(t[0]),t[0].x>t[1].x&&o.swap(t[0],t[1],"x"),t[0].y>t[1].y&&o.swap(t[0],t[1],"y"),t;default:return super.getCoords(e)}}svgArea(){return'<rect x="'+this.coords[0].toString(0,"x")+'" y="'+this.coords[0].toString(0,"y")+'" width="'+this.coords[1].toString(0,"x")+'" height="'+this.coords[1].toString(0,"y")+'" />'}}class i extends n{constructor(e=[],t=0,r,s){super("circle",e,r,s),this.radius=t}getCenter(){return this.firstCoord}isValidShape(){return super.isValidShape()&&this.radius>0}isHover(e,t){let r=this.getCenter();return o.dist(new o(e,t),r)<this.radius}updateLastCoord(e,t){let r=this.getCenter();this.radius=o.dist(r,new o(e,t))}display(e){e.ellipse(this.getCenter().x,this.getCenter().y,2*this.radius)}htmlCoords(e){return this.getCenter().toHtml(e)+","+round(this.radius,e)}svgArea(){return'<circle cx="'+this.coords[0].toString(0,"x")+'" cy="'+this.coords[0].toString(0,"y")+'" r="'+round(this.radius,0)+'" />'}}class d extends n{constructor(e=[],t,r){super("poly",e,t,r)}isValidShape(){return this.coords.length>=4}isHover(e,t){let r,s=this.coords.map(e=>e.x),o=this.coords.map(e=>e.y),n=s.length-1,a=!1,i=s,d=o;for(r=0;r<s.length;r++)(d[r]<t&&d[n]>=t||d[n]<t&&d[r]>=t)&&(i[r]<=e||i[n]<=e)&&(a^=i[r]+(t-d[r])/(d[n]-d[r])*(i[n]-i[r])<e),n=r;return a}isClosable(e,t,r=5){return this.isValidShape()&&this.distToFirstCoord(e,t)<r}close(){this.coords[this.coords.length-1]=this.firstCoord()}move(e){this.coords=this.coords.map(t=>t.sum(e))}display(e){e.beginShape(),this.coords.forEach(t=>e.vertex(t.x,t.y)),e.endShape()}svgArea(){return'<polygon points="'+this.coords.map(e=>e.toString(0,"x")+","+e.toString(0,"y")).join(" ")+'" />'}}class u extends n{constructor(e){super("default",[],e),this.isDefault=!0}isDrawable(){return!0}isHover(){return!0}display(e){e.rect(0,0,e.getMap().width-1,e.getMap().height-1)}svgArea(){return'<rect x="0" y="0" width="100%" height="100%" />'}}var c=r(0),l=r.n(c);r.d(t,"imageMapCreator",function(){return h});let h=function(e,t=600,r=450){let s,c,h="rectangle",f=["rectangle","circle","polygon"],p={SetUrl:{onSelect:(e,t,r,s)=>{!function(e){let t=e.href,r=prompt("Entrez l'url vers laquelle devrait pointer cette zone",t||"http://");null!=r&&(e.setHref(r),x.add({undo:function(){e.setHref(t)},redo:function(){e.setHref(r)}}))}(s)},label:"Set url"},Delete:(e,t,r,s)=>{L(s)},MoveFront:{onSelect:(e,t,r,s)=>{R(s,1)},enabled:!0,label:"Move Forward"},MoveBack:{onSelect:(e,t,r,s)=>{R(s,-1)},enabled:!0,label:"Move Backward"}},m=new n,g=new o,w=!1,v=!1,y=new F,b=new class{constructor(e,t,r=[],s,o=!1){this.name=s,this.width=e,this.height=t,this.areas=r,this.dArea=new u,this.hasDefaultArea=o,this.lastId=0}setFromJson(e){e=JSON.parse(e);for(const t in e)if(e.hasOwnProperty(t)){let r=e[t];"areas"==t?this.areas=r.map(n.fromObject):"dArea"==t?this.dArea=n.fromObject(r):Object.keys(this).includes(t)&&(this[t]=r)}}setName(e){this.name=e.replace(/\s+/g,"")}setSize(e,t){this.width=e,this.height=t}setDefaultArea(e){this.hasDefaultArea=e}getAreas(e=!0){let t=this.areas.slice();return e&&this.hasDefaultArea&&t.unshift(this.dArea),t}addArea(e,t=!0){return t&&e.setId(this.getNewId()),this.areas.push(e),e.id}rmletea(e){let t=this.areaIndex(e);return this.areas.splice(t,1),t}moveArea(e,t){let r=this.areaIndex(e),s=this.areas[r],o=r+t;return!(o<0||o>=this.areas.length)&&(this.rmletea(e),this.insertArea(s,o),o)}popArea(){return this.areas.pop()}insertArea(e,t){this.areas.splice(t,0,e)}areaIndex(e){return this.areas.findIndex(t=>t.id==e)}isFirstArea(e){return 0==this.areaIndex(e)}isLastArea(e){return this.areaIndex(e)==this.areas.length-1}getNewId(){return this.lastId++,this.lastId}toHtml(){let e=[];return this.getAreas().forEach(t=>{t.isValidShape()&&e.push("\t"+t.toHtml())}),'<map name="'+this.name+'" id="'+this.name+'">\n'+e.reverse().join("\n")+"\n</map>"}toSvg(){let e=[];this.getAreas(!1).forEach(t=>{t.isValidShape()&&e.push("\t"+t.toSvg())});let t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+this.width+'" height="'+this.height+'">\n';return t+=e.reverse().join("\n"),t+="\n</svg>"}toJson(){return JSON.stringify(this)}clearAreas(){this.areas=[]}setAreas(e){this.areas=e}}(t,r),x=new UndoManager,A={scale:1,transX:0,transY:0},S={min:.03,max:3,sensativity:.001};function C(){return O(e.mouseX)}function D(){return k(e.mouseY)}function O(e){return(e-A.transX)/A.scale}function k(e){return(e-A.transY)/A.scale}function M(){return e.mouseX<=e.width&&e.mouseX>=0&&e.mouseY<=e.height&&e.mouseY>=0}function j(e){y.appear(),e.preventDefault()}function B(){y.disappear()}function H(t){"image"==t.type?(c=e.loadImage(t.data,t=>(function(t){A.scale=1,A.transX=0,A.transY=0;let r=e.width/t.width,s=e.height/t.height;r<A.scale&&(A.scale=r);s<A.scale&&(A.scale=s);b.setSize(t.width,t.height)})(t)),b.name||(b.setName(t.name),s.setValue("Map Name",b.name))):"json"==t.subtype&&fetch(t.data).then(e=>e.blob()).then(e=>{console.log(e);let t=new FileReader;t.onload=function(){let e=t.result;console.log(e),b.setFromJson(e)},t.readAsText(e)}),y.disappear()}function I(e,t){let r=[new o(e,t)];switch(h){case"rectangle":(m=new a(r)).addCoord(0,0);break;case"circle":m=new i(r);break;case"polygon":(m=new d(r)).addCoord(e,t)}}function E(){l()(b.toJson(),`${b.name}.map.json`,"application/json")}function T(e){b.addArea(e),x.add({undo:function(){e=b.popArea()},redo:function(){b.addArea(e,!1)}})}function L(e){let t=e.id;if(0===t)s.setValue("Default Area",!1);else{let r=b.rmletea(t);x.add({undo:function(){b.insertArea(e,r)},redo:function(){b.rmletea(t)}})}}function R(e,t){!1!==b.moveArea(e.id,t)&&x.add({undo:function(){b.moveArea(e.id,-t)},redo:function(){b.moveArea(e.id,t)}})}function V(){let e=b.getAreas(!1);b.clearAreas(),x.add({undo:function(){b.setAreas(e)},redo:function(){b.clearAreas()}})}function F(e=15){this.speed=e,this.alpha=0,this.over=!1}e.setup=function(){e.createCanvas(t,r).drop(H).dragLeave(B).dragOver(j),s=QuickSettings.create(e.width+5,0,"Image-map Creator",e.canvas.parentElement).setDraggable(!1).addText("Map Name","",e=>{b.setName(e)}).addDropDown("Tool",["rectangle","circle","polygon","inspect","move","delete","test"],e=>{!function(e){h=e,m=new n}(e.value)}).addBoolean("Default Area",b.hasDefaultArea,e=>{!function(e){b.setDefaultArea(e),x.add({undo:function(){b.setDefaultArea(!e),s.setValue("Default Area",!e)},redo:function(){b.setDefaultArea(e),s.setValue("Default Area",e)}})}(e)}).addButton("Undo",x.undo).addButton("Redo",x.redo).addButton("Clear",V).addButton("Generate Html",function(){s.setValue("Output",b.toHtml())}).addButton("Generate Svg",function(){s.setValue("Output",b.toSvg())}).addTextArea("Output").addButton("Save",E),e.canvas.addEventListener("contextmenu",function(e){e.preventDefault()})},e.draw=function(){m.empty()||m.updateLastCoord(C(),D()),v=function(){let e=b.getAreas().reverse().find(e=>e.isHover(C(),D()));return void 0!=e&&e}(),function(){if(f.includes(h))switch(h){case"polygon":if(!m.empty()&&m.isClosable(C(),D(),5/A.scale)){e.cursor(e.HAND);break}default:e.cursor(e.CROSS)}else if(e.cursor(e.ARROW),v)switch(h){case"inspect":case"test":case"delete":e.cursor(e.HAND);break;case"move":e.cursor(e.MOVE)}}(),function(){switch(h){case"inspect":if(M()){let e=v?v.href:"none";s.setValue("Output",e)}}}(),function(){if(e.background(200),!c){e.noStroke(),e.fill(0),e.textSize(15);let t="Drag and drop an image and/or a .map.json save file here";e.text(t,e.width/6,e.height/2)}}(),e.translate(A.transX,A.transY),e.scale(A.scale),c&&e.image(c,0,0,c.width,c.height),y.display(),b.getAreas().concat([m]).forEach(t=>{!function(t){let r=e.color(255,255,255,178);"inspect"!=h&&"test"!=h||(r=e.color(255,0)),(M()&&t==v&&0==w&&("inspect"==h||"delete"==h||"move"==h)||w==t)&&(r=e.color(255,200,200,178)),e.fill(r),e.strokeWeight(1/A.scale),"inspect"==h||"test"==h?e.noStroke():e.stroke(0)}(t),t.isDrawable()&&t.display(e)})},e.getMap=function(){return b},e.mousePressed=function(){if(M()&&e.mouseButton==e.LEFT&&!ContextMenu.isOpen())switch(h){case"circle":case"rectangle":I(C(),D());break;case"polygon":m.empty()?I(C(),D()):m.isClosable(C(),D(),5/A.scale)?(m.close(),m.isValidShape()&&T(m),m=new n):m.addCoord(C(),D());break;case"move":v&&(w="default"!=v.shape&&v,g=w.firstCoord())}},e.mouseDragged=function(){if(M()&&!ContextMenu.isOpen())if(e.mouseButton==e.LEFT)switch(h){case"move":if(w){let t=new o(C()-O(e.pmouseX),D()-k(e.pmouseY));w.move(t)}}else e.mouseButton==e.CENTER&&(A.transX+=e.mouseX-e.pmouseX,A.transY+=e.mouseY-e.pmouseY)},e.mouseReleased=function(t){switch(h){case"rectangle":case"circle":m.isValidShape()&&T(m),m=new n;break;case"move":if(w){let e=w,t=e.firstCoord().diff(g);x.add({undo:function(){e.move(t.invert())},redo:function(){e.move(t)}})}}!function(t){if(M()&&v){if(e.mouseButton==e.RIGHT)return w=v,p.MoveFront.enabled=!(b.isLastArea(v.id)||"default"==v.shape),p.MoveBack.enabled=!(b.isFirstArea(v.id)||"default"==v.shape),ContextMenu.display(t,p,{position:"click",data:v}),!1;if(e.mouseButton==e.LEFT)switch(h){case"test":!function(e,t=400,r=300){window.open(e,"_blank",`width=${t},height=${r}`)}(v.href);break;case"delete":L(v)}}w=!1}(t),y.disappear()},e.mouseWheel=function(e){if(M()){!function(e){let t=A.scale+e;if(t>S.min&&t<S.max){let r=C(),s=D(),o=r*e,n=s*e;A.scale=t,A.transX-=o,A.transY-=n}}(A.scale*S.sensativity*-e.delta)}},F.prototype.appear=function(){this.over=!0},F.prototype.disappear=function(){this.over=!1},F.prototype.display=function(){this.over?this.alpha<100&&(this.alpha+=this.speed):this.alpha>0&&(this.alpha-=this.speed),e.noStroke(),e.fill(255,255,255,this.alpha),e.rect(O(0),k(0),e.width/A.scale,e.height/A.scale)}}}]));