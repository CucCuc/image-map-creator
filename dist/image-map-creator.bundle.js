!function(e,t){for(var r in t)e[r]=t[r]}(window,function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){var s,n,o;n=[],void 0===(o="function"==typeof(s=function(){return function e(t,r,s){var n,o,a=window,i="application/octet-stream",u=s||i,d=t,c=!r&&!s&&d,l=document.createElement("a"),h=function(e){return String(e)},f=a.Blob||a.MozBlob||a.WebKitBlob||h,p=r||"download";if(f=f.call?f.bind(a):Blob,"true"===String(this)&&(u=(d=[d,u])[0],d=d[1]),c&&c.length<2048&&(p=c.split("/").pop().split("?")[0],l.href=c,-1!==l.href.indexOf(c))){var m=new XMLHttpRequest;return m.open("GET",c,!0),m.responseType="blob",m.onload=function(t){e(t.target.response,p,i)},setTimeout(function(){m.send()},0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(d)){if(!(d.length>2096103.424&&f!==h))return navigator.msSaveBlob?navigator.msSaveBlob(y(d),p):b(d);d=y(d),u=d.type||i}else if(/([\x80-\xff])/.test(d)){for(var g=0,w=new Uint8Array(d.length),v=w.length;g<v;++g)w[g]=d.charCodeAt(g);d=new f([w],{type:u})}function y(e){for(var t=e.split(/[:;,]/),r=t[1],s="base64"==t[2]?atob:decodeURIComponent,n=s(t.pop()),o=n.length,a=0,i=new Uint8Array(o);a<o;++a)i[a]=n.charCodeAt(a);return new f([i],{type:r})}function b(e,t){if("download"in l)return l.href=e,l.setAttribute("download",p),l.className="download-js-link",l.innerHTML="downloading...",l.style.display="none",document.body.appendChild(l),setTimeout(function(){l.click(),document.body.removeChild(l),!0===t&&setTimeout(function(){a.URL.revokeObjectURL(l.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var r=document.createElement("iframe");document.body.appendChild(r),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),r.src=e,setTimeout(function(){document.body.removeChild(r)},333)}if(n=d instanceof f?d:new f([d],{type:u}),navigator.msSaveBlob)return navigator.msSaveBlob(n,p);if(a.URL)b(a.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===h)try{return b("data:"+u+";base64,"+a.btoa(n))}catch(e){return b("data:"+u+","+encodeURIComponent(n))}(o=new FileReader).onload=function(e){b(this.result)},o.readAsDataURL(n)}return!0}})?s.apply(t,n):s)||(e.exports=o)},function(e,t,r){var s;!function(){"use strict";var n=function(){var e,t,r=[],s=-1,n=0,o=!1;return t=function(e,t){return e&&"function"==typeof e[t]?(o=!0,e[t](),o=!1,this):this},{add:function(t){return o?this:(r.splice(s+1,r.length-s),r.push(t),n&&r.length>n&&function(e,t,r){e.splice(t,!r||1+r-t+(!(r<0^t>=0)&&(r<0||-1)*e.length)),e.length}(r,0,-(n+1)),s=r.length-1,e&&e(),this)},setCallback:function(t){e=t},undo:function(){var n=r[s];return n?(t(n,"undo"),s-=1,e&&e(),this):this},redo:function(){var n=r[s+1];return n?(t(n,"redo"),s+=1,e&&e(),this):this},clear:function(){var t=r.length;r=[],s=-1,e&&t>0&&e()},hasUndo:function(){return-1!==s},hasRedo:function(){return s<r.length-1},getCommands:function(){return r},getIndex:function(){return s},setLimit:function(e){n=e}}};void 0===(s=function(){return n}.call(t,r,t,e))||(e.exports=s)}()},function(e,t,r){"use strict";function s(e,t,r,s=!0){if(t>r){let e=t;t=r,r=e}return s?e>=t&&e<=r:e>t&&e<r}r.r(t);class n{constructor(e,t){this.set(e,t)}set(e,t){this.x=e,this.y=t}static fromObject(e){return new n(e.x,e.y)}static dist(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static swap(e,t,r){let s=e[r];e[r]=t[r],t[r]=s}isEmpty(){return!this.x&&!this.y}oneIsEmpty(){return!this.x||!this.y}sum(e){return new n(this.x+e.x,this.y+e.y)}diff(e){return new n(this.x-e.x,this.y-e.y)}invert(){return new n(-this.x,-this.y)}toString(e,t){return function(e,t){return parseFloat(e.toFixed(t))}(this[t],e)}toHtml(e){return this.toString(e,"x")+","+this.toString(e,"y")}}class o{constructor(e,t=[],r,s=0){this.setShape(e),this.setCoords(t),this.setHref(r),this.setId(s)}static fromObject(e){switch(e.shape){case"rect":return new a(e.coords.map(n.fromObject),e.href,e.id);case"circle":return new i(e.coords.map(n.fromObject),e.radius,e.href,e.id);case"poly":return new u(e.coords.map(n.fromObject),e.href,e.id);case"default":return new d(e.href);default:throw"Not an area"}}setShape(e){this.shape=e}addCoord(e,t){return this.coords.push(new n(e,t))}setCoords(e){this.coords=e}getCoords(e="default"){switch(e){case"default":default:return this.coords}}empty(){return 0==this.coords.length}copyCoords(){let e=[];return this.coords.forEach((t,r)=>{e[r]=new n(t.x,t.y)}),e}updateLastCoord(e,t){this.coords[this.coords.length-1]=new n(e,t)}move(e){let t=this.firstCoord();void 0!=t&&(this.coords[0]=t.sum(e))}isDrawable(){return this.coords.length>=1}isValidShape(){return this.isDrawable()}setHref(e){this.href=e}setId(e){this.id=e}firstCoord(){return this.coords[0]}distToFirstCoord(e,t){let r=new n(e,t);return n.dist(r,this.firstCoord())}htmlCoords(e){return this.getCoords("html").map(t=>t.toHtml(e)).join(",")}toHtml(){let e=this.htmlCoords(0);return""!=e&&(e='coords="'+e+'" '),'<area shape="'+this.shape+'" '+e+'href="'+this.href+'" alt="'+this.href+'"/>'}svgArea(){}toSvg(){return'<a xlink:href="'+this.href+'">'+this.svgArea()+"</a>"}}class a extends o{constructor(e=[],t,r){super("rect",e,t,r)}setCoords(e){super.setCoords(e.slice(0,2))}updateLastCoord(e,t){if(2==this.coords.length){let r=this.firstCoord();this.coords[1]=new n(e-r.x,t-r.y)}}isDrawable(){return 2==this.coords.length&&!this.coords[1].oneIsEmpty()}isHover(e,t){let r=this.firstCoord(),n=this.coords[1].sum(r);return s(e,r.x,n.x)&&s(t,r.y,n.y)}display(e){e.rect(this.coords[0].x,this.coords[0].y,this.coords[1].x,this.coords[1].y)}getCoords(e="default"){switch(e){case"html":let t=this.copyCoords();return t[1]=t[1].sum(t[0]),t[0].x>t[1].x&&n.swap(t[0],t[1],"x"),t[0].y>t[1].y&&n.swap(t[0],t[1],"y"),t;default:return super.getCoords(e)}}svgArea(){return'<rect x="'+this.coords[0].toString(0,"x")+'" y="'+this.coords[0].toString(0,"y")+'" width="'+this.coords[1].toString(0,"x")+'" height="'+this.coords[1].toString(0,"y")+'" />'}}class i extends o{constructor(e=[],t=0,r,s){super("circle",e,r,s),this.radius=t}getCenter(){return this.firstCoord}isValidShape(){return super.isValidShape()&&this.radius>0}isHover(e,t){let r=this.getCenter();return n.dist(new n(e,t),r)<this.radius}updateLastCoord(e,t){let r=this.getCenter();this.radius=n.dist(r,new n(e,t))}display(e){e.ellipse(this.getCenter().x,this.getCenter().y,2*this.radius)}htmlCoords(e){return this.getCenter().toHtml(e)+","+round(this.radius,e)}svgArea(){return'<circle cx="'+this.coords[0].toString(0,"x")+'" cy="'+this.coords[0].toString(0,"y")+'" r="'+round(this.radius,0)+'" />'}}class u extends o{constructor(e=[],t,r){super("poly",e,t,r)}isValidShape(){return this.coords.length>=4}isHover(e,t){let r,s=this.coords.map(e=>e.x),n=this.coords.map(e=>e.y),o=s.length-1,a=!1,i=s,u=n;for(r=0;r<s.length;r++)(u[r]<t&&u[o]>=t||u[o]<t&&u[r]>=t)&&(i[r]<=e||i[o]<=e)&&(a^=i[r]+(t-u[r])/(u[o]-u[r])*(i[o]-i[r])<e),o=r;return a}isClosable(e,t,r=5){return this.isValidShape()&&this.distToFirstCoord(e,t)<r}close(){this.coords[this.coords.length-1]=this.firstCoord()}move(e){this.coords=this.coords.map(t=>t.sum(e))}display(e){e.beginShape(),this.coords.forEach(t=>e.vertex(t.x,t.y)),e.endShape()}svgArea(){return'<polygon points="'+this.coords.map(e=>e.toString(0,"x")+","+e.toString(0,"y")).join(" ")+'" />'}}class d extends o{constructor(e){super("default",[],e),this.isDefault=!0}isDrawable(){return!0}isHover(){return!0}display(e){e.rect(0,0,e.getMap().width-1,e.getMap().height-1)}svgArea(){return'<rect x="0" y="0" width="100%" height="100%" />'}}var c=r(0),l=r.n(c),h=r(1),f=r.n(h);r.d(t,"imageMapCreator",function(){return p});let p=function(e,t=600,r=450){let s,c,h="rectangle",p=["rectangle","circle","polygon"],m={SetUrl:{onSelect:(e,t,r,s)=>{!function(e){let t=e.href,r=prompt("Entrez l'url vers laquelle devrait pointer cette zone",t||"http://");null!=r&&(e.setHref(r),A.add({undo:function(){e.setHref(t)},redo:function(){e.setHref(r)}}))}(s)},label:"Set url"},Delete:(e,t,r,s)=>{R(s)},MoveFront:{onSelect:(e,t,r,s)=>{V(s,1)},enabled:!0,label:"Move Forward"},MoveBack:{onSelect:(e,t,r,s)=>{V(s,-1)},enabled:!0,label:"Move Backward"}},g=new o,w=new n,v=!1,y=!1,b=new N,x=new class{constructor(e,t,r=[],s,n=!1){this.name=s,this.width=e,this.height=t,this.areas=r,this.dArea=new d,this.hasDefaultArea=n,this.lastId=0}setFromJson(e){e=JSON.parse(e);for(const t in e)if(e.hasOwnProperty(t)){let r=e[t];"areas"==t?this.areas=r.map(o.fromObject):"dArea"==t?this.dArea=o.fromObject(r):Object.keys(this).includes(t)&&(this[t]=r)}}setName(e){this.name=e.replace(/\s+/g,"")}setSize(e,t){this.width=e,this.height=t}setDefaultArea(e){this.hasDefaultArea=e}getAreas(e=!0){let t=this.areas.slice();return e&&this.hasDefaultArea&&t.unshift(this.dArea),t}addArea(e,t=!0){return t&&e.setId(this.getNewId()),this.areas.push(e),e.id}rmletea(e){let t=this.areaIndex(e);return this.areas.splice(t,1),t}moveArea(e,t){let r=this.areaIndex(e),s=this.areas[r],n=r+t;return!(n<0||n>=this.areas.length)&&(this.rmletea(e),this.insertArea(s,n),n)}popArea(){return this.areas.pop()}insertArea(e,t){this.areas.splice(t,0,e)}areaIndex(e){return this.areas.findIndex(t=>t.id==e)}isFirstArea(e){return 0==this.areaIndex(e)}isLastArea(e){return this.areaIndex(e)==this.areas.length-1}getNewId(){return this.lastId++,this.lastId}toHtml(){let e=[];return this.getAreas().forEach(t=>{t.isValidShape()&&e.push("\t"+t.toHtml())}),'<map name="'+this.name+'" id="'+this.name+'">\n'+e.reverse().join("\n")+"\n</map>"}toSvg(){let e=[];this.getAreas(!1).forEach(t=>{t.isValidShape()&&e.push("\t"+t.toSvg())});let t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+this.width+'" height="'+this.height+'">\n';return t+=e.reverse().join("\n"),t+="\n</svg>"}toJson(){return JSON.stringify(this)}clearAreas(){this.areas=[]}setAreas(e){this.areas=e}}(t,r),A=new f.a,C={scale:1,transX:0,transY:0},S={min:.03,max:3,sensativity:.001};function D(){return k(e.mouseX)}function O(){return j(e.mouseY)}function k(e){return(e-C.transX)/C.scale}function j(e){return(e-C.transY)/C.scale}function M(){return e.mouseX<=e.width&&e.mouseX>=0&&e.mouseY<=e.height&&e.mouseY>=0}function B(e){b.appear(),e.preventDefault()}function H(){b.disappear()}function I(t){"image"==t.type?(c=e.loadImage(t.data,t=>(function(t){C.scale=1,C.transX=0,C.transY=0;let r=e.width/t.width,s=e.height/t.height;r<C.scale&&(C.scale=r);s<C.scale&&(C.scale=s);x.setSize(t.width,t.height)})(t)),x.name||(x.setName(t.name),s.setValue("Map Name",x.name))):"json"==t.subtype&&fetch(t.data).then(e=>e.blob()).then(e=>{console.log(e);let t=new FileReader;t.onload=function(){let e=t.result;console.log(e),x.setFromJson(e)},t.readAsText(e)}),b.disappear()}function E(e,t){let r=[new n(e,t)];switch(h){case"rectangle":(g=new a(r)).addCoord(0,0);break;case"circle":g=new i(r);break;case"polygon":(g=new u(r)).addCoord(e,t)}}function L(){l()(x.toJson(),`${x.name}.map.json`,"application/json")}function T(e){x.addArea(e),A.add({undo:function(){e=x.popArea()},redo:function(){x.addArea(e,!1)}})}function R(e){let t=e.id;if(0===t)s.setValue("Default Area",!1);else{let r=x.rmletea(t);A.add({undo:function(){x.insertArea(e,r)},redo:function(){x.rmletea(t)}})}}function V(e,t){!1!==x.moveArea(e.id,t)&&A.add({undo:function(){x.moveArea(e.id,-t)},redo:function(){x.moveArea(e.id,t)}})}function F(){let e=x.getAreas(!1);x.clearAreas(),A.add({undo:function(){x.setAreas(e)},redo:function(){x.clearAreas()}})}function N(e=15){this.speed=e,this.alpha=0,this.over=!1}e.setup=function(){e.createCanvas(t,r).drop(I).dragLeave(H).dragOver(B),s=QuickSettings.create(e.width+5,0,"Image-map Creator",e.canvas.parentElement).setDraggable(!1).addText("Map Name","",e=>{x.setName(e)}).addDropDown("Tool",["rectangle","circle","polygon","inspect","move","delete","test"],e=>{!function(e){h=e,g=new o}(e.value)}).addBoolean("Default Area",x.hasDefaultArea,e=>{!function(e){x.setDefaultArea(e),A.add({undo:function(){x.setDefaultArea(!e),s.setValue("Default Area",!e)},redo:function(){x.setDefaultArea(e),s.setValue("Default Area",e)}})}(e)}).addButton("Undo",A.undo).addButton("Redo",A.redo).addButton("Clear",F).addButton("Generate Html",function(){s.setValue("Output",x.toHtml())}).addButton("Generate Svg",function(){s.setValue("Output",x.toSvg())}).addTextArea("Output").addButton("Save",L),e.canvas.addEventListener("contextmenu",function(e){e.preventDefault()})},e.draw=function(){g.empty()||g.updateLastCoord(D(),O()),y=function(){let e=x.getAreas().reverse().find(e=>e.isHover(D(),O()));return void 0!=e&&e}(),function(){if(p.includes(h))switch(h){case"polygon":if(!g.empty()&&g.isClosable(D(),O(),5/C.scale)){e.cursor(e.HAND);break}default:e.cursor(e.CROSS)}else if(e.cursor(e.ARROW),y)switch(h){case"inspect":case"test":case"delete":e.cursor(e.HAND);break;case"move":e.cursor(e.MOVE)}}(),function(){switch(h){case"inspect":if(M()){let e=y?y.href:"none";s.setValue("Output",e)}}}(),function(){if(e.background(200),!c){e.noStroke(),e.fill(0),e.textSize(15);let t="Drag and drop an image and/or a .map.json save file here";e.text(t,e.width/6,e.height/2)}}(),e.translate(C.transX,C.transY),e.scale(C.scale),c&&e.image(c,0,0,c.width,c.height),b.display(),x.getAreas().concat([g]).forEach(t=>{!function(t){let r=e.color(255,255,255,178);"inspect"!=h&&"test"!=h||(r=e.color(255,0)),(M()&&t==y&&0==v&&("inspect"==h||"delete"==h||"move"==h)||v==t)&&(r=e.color(255,200,200,178)),e.fill(r),e.strokeWeight(1/C.scale),"inspect"==h||"test"==h?e.noStroke():e.stroke(0)}(t),t.isDrawable()&&t.display(e)})},e.getMap=function(){return x},e.mousePressed=function(){if(M()&&e.mouseButton==e.LEFT&&!ContextMenu.isOpen())switch(h){case"circle":case"rectangle":E(D(),O());break;case"polygon":g.empty()?E(D(),O()):g.isClosable(D(),O(),5/C.scale)?(g.close(),g.isValidShape()&&T(g),g=new o):g.addCoord(D(),O());break;case"move":y&&(v="default"!=y.shape&&y,w=v.firstCoord())}},e.mouseDragged=function(){if(M()&&!ContextMenu.isOpen())if(e.mouseButton==e.LEFT)switch(h){case"move":if(v){let t=new n(D()-k(e.pmouseX),O()-j(e.pmouseY));v.move(t)}}else e.mouseButton==e.CENTER&&(C.transX+=e.mouseX-e.pmouseX,C.transY+=e.mouseY-e.pmouseY)},e.mouseReleased=function(t){switch(h){case"rectangle":case"circle":g.isValidShape()&&T(g),g=new o;break;case"move":if(v){let e=v,t=e.firstCoord().diff(w);A.add({undo:function(){e.move(t.invert())},redo:function(){e.move(t)}})}}!function(t){if(M()&&y){if(e.mouseButton==e.RIGHT)return v=y,m.MoveFront.enabled=!(x.isLastArea(y.id)||"default"==y.shape),m.MoveBack.enabled=!(x.isFirstArea(y.id)||"default"==y.shape),ContextMenu.display(t,m,{position:"click",data:y}),!1;if(e.mouseButton==e.LEFT)switch(h){case"test":!function(e,t=400,r=300){window.open(e,"_blank",`width=${t},height=${r}`)}(y.href);break;case"delete":R(y)}}v=!1}(t),b.disappear()},e.mouseWheel=function(e){if(M()){!function(e){let t=C.scale+e;if(t>S.min&&t<S.max){let r=D(),s=O(),n=r*e,o=s*e;C.scale=t,C.transX-=n,C.transY-=o}}(C.scale*S.sensativity*-e.delta)}},N.prototype.appear=function(){this.over=!0},N.prototype.disappear=function(){this.over=!1},N.prototype.display=function(){this.over?this.alpha<100&&(this.alpha+=this.speed):this.alpha>0&&(this.alpha-=this.speed),e.noStroke(),e.fill(255,255,255,this.alpha),e.rect(k(0),j(0),e.width/C.scale,e.height/C.scale)}}}]));